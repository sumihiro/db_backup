# データベースバックアップスクリプト

このプロジェクトは、複数のMySQLデータベースを定期的にバックアップするためのPythonスクリプトを提供します。

## 機能

- 複数のデータベースを指定してバックアップ
- バックアップファイルの保存期間の設定
- 古いバックアップファイルの自動削除

## 必要条件

- Python 3.6以上
- PyYAML
- MySQLクライアント（mysqldump）

## セットアップ

1. このリポジトリをクローンまたはダウンロードします。

2. 必要なPythonパッケージをインストールします：

   ```
   pip install pyyaml
   ```

3. `config.yaml.example`を`config.yaml`にコピーし、必要な情報を入力します：

   ```yaml
   retention_days: 14
   databases:
     - host: "localhost"
       database: "db_name"
       user: "db_user"
       password: "db_password"
     # 必要に応じて他のデータベースを追加
   ```

## 使用方法

1. `backup.py`スクリプトを実行します：

   ```
   python backup.py
   ```

2. バックアップファイルは`backup/ホスト名/データベース名/`ディレクトリに`YYYY-MM-DD.sql`の形式で保存されます。

3. 指定した保持期間を超えた古いバックアップファイルは自動的に削除されます。

## 定期実行の設定

cronを使用して毎日自動実行するには、以下のようなcron jobを設定します：

```
0 1 * * * /usr/bin/python /path/to/backup.py
```

これにより、毎日午前1時にバックアップスクリプトが実行されます。

## 注意事項

- このスクリプトはMySQLデータベースを想定しています。他のデータベース系を使用している場合は、`backup_database`関数内のコマンドを適切に変更する必要があります。

## トラブルシューティング

スクリプトが正しく動作しない場合は、以下を確認してください：

1. `config.yaml`ファイルが正しく設定されているか
2. データベースの接続情報が正確か
3. 必要なパッケージがすべてインストールされているか
4. バックアップディレクトリに書き込み権限があるか

問題が解決しない場合は、スクリプトの出力ログを確認し、エラーメッセージを参照してください。
